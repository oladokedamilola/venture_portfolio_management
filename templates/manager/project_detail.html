{% extends 'base_user.html' %}
{% load static %}

{% block title %}{{ project.name }} - VentureNest{% endblock %}

{% block page_title %}{{ project.name }}{% endblock %}
{% block page_subtitle %}{{ project.startup.name }} â€¢ {{ project.get_status_display }}{% endblock %}

{% block page_actions %}
<div class="btn-group">
    <a href="#" class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#editProjectModal">
        <i class="bi bi-pencil me-1"></i>Edit
    </a>
    <button class="btn btn-outline-primary btn-sm dropdown-toggle" type="button" data-bs-toggle="dropdown">
        <i class="bi bi-three-dots-vertical"></i>
    </button>
    <ul class="dropdown-menu">
        <li><a class="dropdown-item" href="#">
            <i class="bi bi-clipboard-check me-2"></i>Mark Complete
        </a></li>
        <li><a class="dropdown-item" href="#">
            <i class="bi bi-archive me-2"></i>Archive
        </a></li>
        <li><hr class="dropdown-divider"></li>
        <li><a class="dropdown-item text-danger" href="#">
            <i class="bi bi-trash me-2"></i>Delete
        </a></li>
    </ul>
</div>
{% endblock %}

{% block user_content %}
<div class="row">
    <!-- Main Content -->
    <div class="col-lg-8">
        <!-- Project Overview -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-white py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-info-circle text-nest me-2"></i>Project Overview
                    </h5>
                    <div class="d-flex gap-2">
                        <span class="badge {% if project.status == 'active' %}bg-success{% elif project.status == 'planning' %}bg-info{% elif project.status == 'on_hold' %}bg-warning{% else %}bg-secondary{% endif %}">
                            {{ project.get_status_display }}
                        </span>
                        <span class="badge {% if project.priority == 'critical' %}bg-danger{% elif project.priority == 'high' %}bg-warning{% elif project.priority == 'medium' %}bg-primary{% else %}bg-secondary{% endif %}">
                            {{ project.get_priority_display }} Priority
                        </span>
                    </div>
                </div>
            </div>
            <div class="card-body">
                <div class="row mb-4">
                    <div class="col-md-8">
                        <p class="text-muted mb-3">{{ project.description }}</p>
                        
                        <!-- Key Metrics -->
                        <div class="row text-center mb-4">
                            <div class="col-3">
                                <div class="metric-value fw-bold text-nest">85%</div>
                                <small class="text-muted">Progress</small>
                            </div>
                            <div class="col-3">
                                <div class="metric-value fw-bold text-nest">18/24</div>
                                <small class="text-muted">Tasks Done</small>
                            </div>
                            <div class="col-3">
                                <div class="metric-value fw-bold text-nest">12</div>
                                <small class="text-muted">Days Left</small>
                            </div>
                            <div class="col-3">
                                <div class="metric-value fw-bold text-nest">5</div>
                                <small class="text-muted">Team Members</small>
                            </div>
                        </div>

                        <!-- Progress Bar -->
                        <div class="mb-4">
                            <div class="d-flex justify-content-between mb-2">
                                <span class="fw-semibold">Overall Progress</span>
                                <span class="text-muted">85%</span>
                            </div>
                            <div class="progress" style="height: 10px;">
                                <div class="progress-bar bg-success" style="width: 85%"></div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="project-timeline">
                            <div class="timeline-item mb-3">
                                <div class="text-muted small">Start Date</div>
                                <div class="fw-semibold">{{ project.start_date|date:"M d, Y" }}</div>
                            </div>
                            <div class="timeline-item mb-3">
                                <div class="text-muted small">Due Date</div>
                                <div class="fw-semibold">{{ project.due_date|date:"M d, Y" }}</div>
                            </div>
                            <div class="timeline-item">
                                <div class="text-muted small">Last Updated</div>
                                <div class="fw-semibold">{{ project.updated_at|timesince }} ago</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Key Details -->
                <div class="row">
                    <div class="col-md-6">
                        <table class="table table-sm table-borderless">
                            <tr>
                                <td class="text-muted">Startup:</td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="{{ project.startup.logo.url|default:'/static/images/default-startup.png' }}" 
                                             alt="{{ project.startup.name }}" 
                                             class="rounded-circle me-2" 
                                             width="24" 
                                             height="24">
                                        <span class="fw-semibold">{{ project.startup.name }}</span>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td class="text-muted">Project Lead:</td>
                                <td class="fw-semibold">Alex Chen</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Budget:</td>
                                <td class="fw-semibold">$50,000</td>
                            </tr>
                        </table>
                    </div>
                    <div class="col-md-6">
                        <table class="table table-sm table-borderless">
                            <tr>
                                <td class="text-muted">Category:</td>
                                <td class="fw-semibold">Product Development</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Created:</td>
                                <td class="fw-semibold">{{ project.created_at|date:"M d, Y" }}</td>
                            </tr>
                            <tr>
                                <td class="text-muted">Milestones:</td>
                                <td class="fw-semibold">3/5 Completed</td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Tasks Section -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-white py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-list-check text-nest me-2"></i>Tasks
                    </h5>
                    <button class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addTaskModal">
                        <i class="bi bi-plus-circle me-1"></i>Add Task
                    </button>
                </div>
            </div>
            <div class="card-body p-0">
                <div class="table-responsive">
                    <table class="table table-hover mb-0">
                        <thead class="table-light">
                            <tr>
                                <th style="width: 40px;"></th>
                                <th>Task</th>
                                <th>Assignee</th>
                                <th>Due Date</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked>
                                    </div>
                                </td>
                                <td>
                                    <div class="fw-semibold">Design User Interface</div>
                                    <small class="text-muted">Create wireframes and mockups</small>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="/static/images/avatar4.png" alt="Sarah" class="rounded-circle me-2" width="24" height="24">
                                        <span>Sarah Chen</span>
                                    </div>
                                </td>
                                <td>Dec 10, 2023</td>
                                <td><span class="badge bg-success">Completed</span></td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary border-0" data-bs-toggle="dropdown">
                                            <i class="bi bi-three-dots-vertical"></i>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#">Edit</a></li>
                                            <li><a class="dropdown-item" href="#">Reassign</a></li>
                                            <li><a class="dropdown-item text-danger" href="#">Delete</a></li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" checked>
                                    </div>
                                </td>
                                <td>
                                    <div class="fw-semibold">Backend API Development</div>
                                    <small class="text-muted">Implement REST APIs</small>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="/static/images/avatar5.png" alt="Mike" class="rounded-circle me-2" width="24" height="24">
                                        <span>Mike Rodriguez</span>
                                    </div>
                                </td>
                                <td>Dec 12, 2023</td>
                                <td><span class="badge bg-success">Completed</span></td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary border-0" data-bs-toggle="dropdown">
                                            <i class="bi bi-three-dots-vertical"></i>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#">Edit</a></li>
                                            <li><a class="dropdown-item" href="#">Reassign</a></li>
                                            <li><a class="dropdown-item text-danger" href="#">Delete</a></li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox">
                                    </div>
                                </td>
                                <td>
                                    <div class="fw-semibold">Testing & QA</div>
                                    <small class="text-muted">Comprehensive testing phase</small>
                                </td>
                                <td>
                                    <div class="d-flex align-items-center">
                                        <img src="/static/images/avatar6.png" alt="Lisa" class="rounded-circle me-2" width="24" height="24">
                                        <span>Lisa Wang</span>
                                    </div>
                                </td>
                                <td>Dec 15, 2023</td>
                                <td><span class="badge bg-warning">In Progress</span></td>
                                <td>
                                    <div class="dropdown">
                                        <button class="btn btn-sm btn-outline-secondary border-0" data-bs-toggle="dropdown">
                                            <i class="bi bi-three-dots-vertical"></i>
                                        </button>
                                        <ul class="dropdown-menu">
                                            <li><a class="dropdown-item" href="#">Edit</a></li>
                                            <li><a class="dropdown-item" href="#">Reassign</a></li>
                                            <li><a class="dropdown-item text-danger" href="#">Delete</a></li>
                                        </ul>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Milestones -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-white py-3">
                <h5 class="card-title mb-0">
                    <i class="bi bi-flag text-nest me-2"></i>Milestones
                </h5>
            </div>
            <div class="card-body">
                <div class="milestone-tracker">
                    <div class="milestone-item completed">
                        <div class="milestone-icon">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                        <div class="milestone-content">
                            <div class="fw-semibold">Project Kickoff</div>
                            <small class="text-muted">Team alignment and planning</small>
                            <div class="text-muted small">Completed on Nov 1, 2023</div>
                        </div>
                    </div>
                    <div class="milestone-item completed">
                        <div class="milestone-icon">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                        <div class="milestone-content">
                            <div class="fw-semibold">Design Phase</div>
                            <small class="text-muted">UI/UX design completion</small>
                            <div class="text-muted small">Completed on Nov 20, 2023</div>
                        </div>
                    </div>
                    <div class="milestone-item completed">
                        <div class="milestone-icon">
                            <i class="bi bi-check-circle-fill"></i>
                        </div>
                        <div class="milestone-content">
                            <div class="fw-semibold">Development Phase</div>
                            <small class="text-muted">Core feature development</small>
                            <div class="text-muted small">Completed on Dec 10, 2023</div>
                        </div>
                    </div>
                    <div class="milestone-item current">
                        <div class="milestone-icon">
                            <i class="bi bi-arrow-right-circle-fill"></i>
                        </div>
                        <div class="milestone-content">
                            <div class="fw-semibold">Testing Phase</div>
                            <small class="text-muted">QA and bug fixes</small>
                            <div class="text-muted small">Due: Dec 15, 2023</div>
                        </div>
                    </div>
                    <div class="milestone-item upcoming">
                        <div class="milestone-icon">
                            <i class="bi bi-circle"></i>
                        </div>
                        <div class="milestone-content">
                            <div class="fw-semibold">Launch</div>
                            <small class="text-muted">Production deployment</small>
                            <div class="text-muted small">Due: Dec 20, 2023</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
        <!-- Team Members -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-white py-3">
                <div class="d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-people text-nest me-2"></i>Team
                    </h5>
                    <button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal" data-bs-target="#manageTeamModal">
                        Manage
                    </button>
                </div>
            </div>
            <div class="card-body">
                <div class="team-members">
                    <div class="team-member d-flex align-items-center mb-3">
                        <img src="/static/images/avatar4.png" alt="Sarah" class="rounded-circle me-3" width="40" height="40">
                        <div class="flex-grow-1">
                            <div class="fw-semibold">Sarah Chen</div>
                            <small class="text-muted">UI/UX Designer</small>
                        </div>
                        <span class="badge bg-success">Active</span>
                    </div>
                    <div class="team-member d-flex align-items-center mb-3">
                        <img src="/static/images/avatar5.png" alt="Mike" class="rounded-circle me-3" width="40" height="40">
                        <div class="flex-grow-1">
                            <div class="fw-semibold">Mike Rodriguez</div>
                            <small class="text-muted">Backend Developer</small>
                        </div>
                        <span class="badge bg-success">Active</span>
                    </div>
                    <div class="team-member d-flex align-items-center mb-3">
                        <img src="/static/images/avatar6.png" alt="Lisa" class="rounded-circle me-3" width="40" height="40">
                        <div class="flex-grow-1">
                            <div class="fw-semibold">Lisa Wang</div>
                            <small class="text-muted">QA Engineer</small>
                        </div>
                        <span class="badge bg-warning">Away</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="card shadow-sm border-0 mb-4">
            <div class="card-header bg-white py-3">
                <h5 class="card-title mb-0">
                    <i class="bi bi-clock text-nest me-2"></i>Recent Activity
                </h5>
            </div>
            <div class="card-body">
                <div class="activity-timeline">
                    <div class="activity-item d-flex mb-3">
                        <div class="activity-icon flex-shrink-0 me-3">
                            <i class="bi bi-check-circle text-success"></i>
                        </div>
                        <div class="activity-content">
                            <div class="fw-semibold">Task Completed</div>
                            <small class="text-muted">Backend API Development by Mike</small>
                            <div class="text-muted small">2 hours ago</div>
                        </div>
                    </div>
                    <div class="activity-item d-flex mb-3">
                        <div class="activity-icon flex-shrink-0 me-3">
                            <i class="bi bi-chat-left-text text-primary"></i>
                        </div>
                        <div class="activity-content">
                            <div class="fw-semibold">New Comment</div>
                            <small class="text-muted">Sarah commented on design review</small>
                            <div class="text-muted small">5 hours ago</div>
                        </div>
                    </div>
                    <div class="activity-item d-flex">
                        <div class="activity-icon flex-shrink-0 me-3">
                            <i class="bi bi-flag text-warning"></i>
                        </div>
                        <div class="activity-content">
                            <div class="fw-semibold">Milestone Reached</div>
                            <small class="text-muted">Development phase completed</small>
                            <div class="text-muted small">1 day ago</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Documents -->
        <div class="card shadow-sm border-0">
            <div class="card-header bg-white py-3">
                <h5 class="card-title mb-0">
                    <i class="bi bi-folder text-nest me-2"></i>Documents
                </h5>
            </div>
            <div class="card-body">
                <div class="document-item d-flex align-items-center justify-content-between mb-2">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-file-earmark-text text-primary me-2"></i>
                        <span class="small">Project_Brief.pdf</span>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-download"></i>
                    </button>
                </div>
                <div class="document-item d-flex align-items-center justify-content-between mb-2">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-file-earmark-spreadsheet text-success me-2"></i>
                        <span class="small">Budget_Sheet.xlsx</span>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-download"></i>
                    </button>
                </div>
                <div class="document-item d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-file-earmark-image text-warning me-2"></i>
                        <span class="small">Design_Mockups.zip</span>
                    </div>
                    <button class="btn btn-sm btn-outline-secondary">
                        <i class="bi bi-download"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Add Task Modal -->
<div class="modal fade" id="addTaskModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Add New Task</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form>
                    <div class="mb-3">
                        <label class="form-label">Task Title</label>
                        <input type="text" class="form-control" placeholder="Enter task title">
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" rows="3" placeholder="Task description..."></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Assignee</label>
                                <select class="form-select">
                                    <option>Sarah Chen</option>
                                    <option>Mike Rodriguez</option>
                                    <option>Lisa Wang</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label class="form-label">Due Date</label>
                                <input type="date" class="form-control">
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-primary">Add Task</button>
            </div>
        </div>
    </div>
</div>

<style>
    .metric-value {
        font-size: 1.25rem;
    }

    .progress {
        background-color: #e9ecef;
    }

    .milestone-tracker {
        position: relative;
        padding-left: 30px;
    }

    .milestone-item {
        position: relative;
        padding: 1rem 0;
        border-left: 2px solid #e9ecef;
    }

    .milestone-item:last-child {
        border-left: 2px solid transparent;
    }

    .milestone-item.completed {
        border-left-color: var(--color-nest-green);
    }

    .milestone-item.current {
        border-left-color: var(--color-sky-blue);
    }

    .milestone-icon {
        position: absolute;
        left: -30px;
        top: 1rem;
        width: 20px;
        height: 20px;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .milestone-item.completed .milestone-icon {
        color: var(--color-nest-green);
    }

    .milestone-item.current .milestone-icon {
        color: var(--color-sky-blue);
    }

    .milestone-item.upcoming .milestone-icon {
        color: #6c757d;
    }

    .activity-icon {
        width: 32px;
        height: 32px;
        background: #f8f9fa;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .team-member:hover {
        background-color: #f8f9fa;
        border-radius: 0.375rem;
        padding: 0.5rem;
        margin: -0.5rem;
    }

    .document-item:hover {
        background-color: #f8f9fa;
        border-radius: 0.375rem;
        padding: 0.5rem;
        margin: -0.5rem;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Task completion toggle
        document.querySelectorAll('.form-check-input').forEach(checkbox => {
            checkbox.addEventListener('change', function() {
                const row = this.closest('tr');
                const statusBadge = row.querySelector('.badge');
                
                if (this.checked) {
                    statusBadge.className = 'badge bg-success';
                    statusBadge.textContent = 'Completed';
                } else {
                    statusBadge.className = 'badge bg-warning';
                    statusBadge.textContent = 'In Progress';
                }
                
                // Update progress metrics
                updateProgressMetrics();
            });
        });

        function updateProgressMetrics() {
            const totalTasks = document.querySelectorAll('tbody tr').length;
            const completedTasks = document.querySelectorAll('tbody input:checked').length;
            const progress = Math.round((completedTasks / totalTasks) * 100);
            
            // Update progress bar
            const progressBar = document.querySelector('.progress-bar');
            progressBar.style.width = `${progress}%`;
            
            // Update progress text
            const progressText = document.querySelector('.progress + .text-muted');
            if (progressText) {
                progressText.textContent = `${progress}%`;
            }
            
            // Update tasks done metric
            const tasksDone = document.querySelector('.metric-value:nth-child(2)');
            if (tasksDone) {
                tasksDone.textContent = `${completedTasks}/${totalTasks}`;
            }
        }

        // Initialize progress
        updateProgressMetrics();
    });
</script>
{% endblock %}