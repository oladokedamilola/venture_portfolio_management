<!-- Bootstrap Icons -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css" rel="stylesheet">

<script>
  // Toggle password visibility
  document.querySelectorAll(".toggle-password").forEach(button => {
    button.addEventListener("click", () => {
      const inputId = button.getAttribute("data-target");
      const input = document.getElementById(inputId);
      const icon = button.querySelector("i");

      if (input.type === "password") {
        input.type = "text";
        icon.classList.replace("bi-eye", "bi-eye-slash");
      } else {
        input.type = "password";
        icon.classList.replace("bi-eye-slash", "bi-eye");
      }
    });
  });

  // Password strength validation
  const passwordInput = document.getElementById("id_password1");
  const rulesWrapper = document.getElementById("password-rules-wrapper");

  passwordInput.addEventListener("focus", () => {
    rulesWrapper.style.maxHeight = rulesWrapper.scrollHeight + "px";
  });
  passwordInput.addEventListener("blur", () => {
    rulesWrapper.style.maxHeight = "0";
  });

  passwordInput.addEventListener("input", () => {
    const value = passwordInput.value;

    const rules = {
      length: value.length >= 8,
      uppercase: /[A-Z]/.test(value),
      lowercase: /[a-z]/.test(value),
      number: /[0-9]/.test(value),
      symbol: /[^A-Za-z0-9]/.test(value),
    };

    for (let [rule, passed] of Object.entries(rules)) {
      const element = document.getElementById(`rule-${rule}`);
      element.textContent = (passed ? "✅ " : "❌ ") + element.textContent.replace(/^[✅❌]\s*/, "");
      element.classList.toggle("text-success", passed);
      element.classList.toggle("text-danger", !passed);
    }
  });

  // Confirm password match
  const confirmPasswordInput = document.getElementById("id_password2");
  const matchFeedback = document.getElementById("password-match-feedback");

  function checkPasswordMatch() {
    if (!confirmPasswordInput.value) {
      matchFeedback.textContent = "";
      return;
    }
    if (confirmPasswordInput.value === passwordInput.value) {
      matchFeedback.textContent = "✅ Passwords match";
      matchFeedback.classList.add("text-success");
      matchFeedback.classList.remove("text-danger");
    } else {
      matchFeedback.textContent = "❌ Passwords do not match";
      matchFeedback.classList.add("text-danger");
      matchFeedback.classList.remove("text-success");
    }
  }

  confirmPasswordInput.addEventListener("input", checkPasswordMatch);
  passwordInput.addEventListener("input", checkPasswordMatch);
</script>
